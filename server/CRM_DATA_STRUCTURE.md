# Структура данных для CRM

## Финальная структура данных

Приложение отправляет в CRM следующие данные:

### Этап 1: Заполнение формы (createLead)

```json
{
  "name": "Джон Смит",
  "phone": "+7 700 000 00 00",
  "email": "jsm@mail.ru"
}
```

### Этап 2: Результаты теста (updateLeadWithResults)

```json
{
  "test_result": "Тяжелая степень",
  "average_db": 75,
  "left_ear_avg_db": 78,
  "right_ear_avg_db": 72,
  "test_date": "2025-10-30T10:30:00Z"
}
```

## Описание полей

| Поле | Тип | Пример | Описание |
|------|-----|--------|----------|
| `name` | string | "Джон Смит" | ФИО клиента |
| `phone` | string | "+7 700 000 00 00" | Номер телефона (с форматированием) |
| `email` | string | "jsm@mail.ru" | Email адрес |
| `test_result` | string | "Тяжелая степень" | Текстовое описание результата теста |
| `average_db` | number | 75 | Средний уровень dB обоих ушей |
| `left_ear_avg_db` | number | 78 | Средний уровень dB левого уха |
| `right_ear_avg_db` | number | 72 | Средний уровень dB правого уха |
| `test_date` | string | "2025-10-30T10:30:00Z" | Дата и время прохождения теста (ISO 8601) |

## Возможные значения test_result

- "Нормальный слух" (0-25 dB)
- "Легкая степень" (26-40 dB)
- "Умеренная степень" (41-55 dB)
- "Выраженная степень" (56-70 dB)
- "Тяжелая степень" (71+ dB)

## Как адаптировать под ваш CRM

1. Откройте файл `server/services/crmService.js`
2. Найдите переменную `crmData` в функциях:
   - `createLead()` - для данных формы
   - `updateLeadWithResults()` - для результатов теста
3. Измените названия полей согласно документации вашего CRM

### Пример адаптации

Если ваш CRM требует другие названия полей:

```javascript
// Вместо:
const crmData = {
  test_result: interpretation.text,
  average_db: Math.round(avgDb)
};

// Используйте:
const crmData = {
  hearing_result: interpretation.text,
  avg_decibels: Math.round(avgDb)
};
```

## Примечание

Структура выбрана для оптимального баланса:
- Достаточно информации для анализа состояния клиента
- CRM может делать аналитику (фильтровать по dB, по степени)
- Легко читать менеджерам
- Не перегружена лишними данными
